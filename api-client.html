<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krosy.ua API Client</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –ê–Ω—ñ–º–∞—Ü—ñ—è –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å */
        .toast {
            transition: all 0.5s ease;
            transform: translateX(100%);
            opacity: 0;
        }
        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-8">

    <div class="max-w-4xl mx-auto">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-indigo-600 mb-2">üëü –ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏</h1>
            <p class="text-gray-600">–†–æ–±–æ—Ç–∞ –∑ API —á–µ—Ä–µ–∑ Fetch (–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ 6)</p>
        </header>

        <div id="messageBox" class="fixed top-5 right-5 z-50"></div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            
            <div class="bg-white p-6 rounded-xl shadow-lg h-fit">
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    ‚ûï –î–æ–¥–∞—Ç–∏ –∫—Ä–æ—Å—ñ–≤–∫–∏
                </h2>
                <form id="addForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">–ù–∞–∑–≤–∞ –º–æ–¥–µ–ª—ñ</label>
                        <input type="text" id="pName" class="w-full border p-2 rounded focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Nike Air Force" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">–¶—ñ–Ω–∞ (–≥—Ä–Ω)</label>
                        <input type="number" id="pPrice" class="w-full border p-2 rounded focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="3500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                        <select id="pCategory" class="w-full border p-2 rounded focus:ring-2 focus:ring-indigo-500 outline-none">
                            <option value="Running">–ë—ñ–≥–æ–≤—ñ</option>
                            <option value="Casual">–ü–æ–≤—Å—è–∫–¥–µ–Ω–Ω—ñ</option>
                            <option value="Basketball">–ë–∞—Å–∫–µ—Ç–±–æ–ª—å–Ω—ñ</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition flex justify-center items-center gap-2">
                        <span>–ó–±–µ—Ä–µ–≥—Ç–∏</span>
                        <div id="btnSpinner" class="hidden w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    </button>
                </form>
            </div>

            <div class="md:col-span-2">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">üì¶ –°–ø–∏—Å–æ–∫ –Ω–∞ —Å–∫–ª–∞–¥—ñ</h2>
                    <button onclick="loadData()" class="text-indigo-600 hover:text-indigo-800 text-sm font-bold">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>
                </div>

                <div id="dataList" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="col-span-2 text-center text-gray-400 py-10">
                        –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:5000/api/products'; // –ê–¥—Ä–µ—Å–∞ —Ç–≤–æ–≥–æ API

        // 1. –§—É–Ω–∫—Ü—ñ—è –ø–æ–∫–∞–∑—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (—É—Å–ø—ñ—Ö/–ø–æ–º–∏–ª–∫–∞)
        function showMessage(text, isError = false) {
            const msgBox = document.getElementById('messageBox');
            const toast = document.createElement('div');
            
            toast.className = `toast show mb-2 px-6 py-3 rounded shadow-lg text-white font-bold flex items-center gap-2 ${isError ? 'bg-red-500' : 'bg-green-500'}`;
            toast.innerHTML = isError ? `‚ùå ${text}` : `‚úÖ ${text}`;
            
            msgBox.appendChild(toast);

            // –í–∏–¥–∞–ª—è—î–º–æ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        // 2. –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö (GET)
        async function loadData() {
            const container = document.getElementById('dataList');
            
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('–ü–æ–º–∏–ª–∫–∞ –∑\'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º');
                
                const products = await response.json();
                
                // –û—á–∏—â–∞—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                container.innerHTML = '';

                if (products.length === 0) {
                    container.innerHTML = '<div class="col-span-2 text-center text-gray-500">–¢–æ–≤–∞—Ä—ñ–≤ –Ω–µ–º–∞—î. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–∏–π!</div>';
                    return;
                }

                // –ú–∞–ª—é—î–º–æ –∫–∞—Ä—Ç–∫–∏
                products.reverse().forEach(product => { // reverse —â–æ–± –Ω–æ–≤—ñ –±—É–ª–∏ –∑–≤–µ—Ä—Ö—É
                    const card = document.createElement('div');
                    card.className = 'bg-white p-4 rounded-lg shadow border border-gray-100 hover:shadow-md transition relative group';
                    card.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="text-xs font-bold text-indigo-500 uppercase tracking-wide">${product.category || 'General'}</span>
                                <h3 class="text-lg font-bold text-gray-800">${product.name}</h3>
                                <p class="text-gray-600 mt-1">${product.price} –≥—Ä–Ω</p>
                            </div>
                            <div class="bg-gray-100 p-2 rounded-full text-gray-400">üëü</div>
                        </div>
                        <button onclick="deleteProduct(${product.id})" class="absolute top-2 right-2 text-red-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition" title="–í–∏–¥–∞–ª–∏—Ç–∏">
                            üóëÔ∏è
                        </button>
                    `;
                    container.appendChild(card);
                });

            } catch (error) {
                container.innerHTML = `<div class="col-span-2 text-center text-red-500 bg-red-50 p-4 rounded">‚ö†Ô∏è –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–æ–≤–∞—Ä–∏: ${error.message}<br>–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –∑–∞–ø—É—â–µ–Ω–æ Python —Å–µ—Ä–≤–µ—Ä!</div>`;
            }
        }

        // 3. –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É (POST)
        document.getElementById('addForm').addEventListener('submit', async (e) => {
            e.preventDefault(); // –©–æ–± —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –Ω–µ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–ª–∞—Å—å
            
            const btn = e.target.querySelector('button');
            const spinner = document.getElementById('btnSpinner');
            
            // –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –ø–æ–ª—ñ–≤
            const name = document.getElementById('pName').value;
            const price = parseFloat(document.getElementById('pPrice').value);
            const category = document.getElementById('pCategory').value;

            // –ë–ª–æ–∫—É—î–º–æ –∫–Ω–æ–ø–∫—É
            btn.disabled = true;
            spinner.classList.remove('hidden');

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, price, category })
                });

                if (!response.ok) throw new Error('–°–µ—Ä–≤–µ—Ä –ø–æ–≤–µ—Ä–Ω—É–≤ –ø–æ–º–∏–ª–∫—É');

                const result = await response.json();
                
                showMessage(`–¢–æ–≤–∞—Ä "${name}" —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!`);
                e.target.reset(); // –û—á–∏—Å—Ç–∏—Ç–∏ —Ñ–æ—Ä–º—É
                loadData(); // –û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫

            } catch (error) {
                showMessage(error.message, true);
            } finally {
                // –†–æ–∑–±–ª–æ–∫—É—î–º–æ –∫–Ω–æ–ø–∫—É
                btn.disabled = false;
                spinner.classList.add('hidden');
            }
        });

        // 4. –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É (DELETE)
        async function deleteProduct(id) {
            if(!confirm('–¢–æ—á–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä?')) return;

            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showMessage('–¢–æ–≤–∞—Ä –≤–∏–¥–∞–ª–µ–Ω–æ');
                    loadData();
                } else {
                    throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏');
                }
            } catch (error) {
                showMessage(error.message, true);
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        loadData();
    </script>
</body>
</html>